import"./index-C1WVuFIU.js";/* empty css              */import{c as G,e as K,f as Q,a as W}from"./locatariosService-BxzGqk0_.js";const D=6;let u=1,f=[],E=null,k=null;const P=()=>localStorage.getItem("roleUser"),F=document.querySelector("#users-table tbody"),I=document.getElementById("pagination"),V=document.getElementById("search-input"),B=document.getElementById("mensagem-erro"),H=document.getElementById("modal-overlay"),N=document.getElementById("modal-cadastrar"),z=document.getElementById("modal-atualizar"),U=document.getElementById("modal-cadastrando"),q=document.getElementById("modal-atualizando"),S=document.getElementById("modal-confirmando"),A=document.getElementById("modal-deletando"),R=document.getElementById("form-cadastrar"),_=document.getElementById("form-atualizar"),d=document.getElementById("register-name"),n=document.getElementById("register-email"),y=document.getElementById("register-celular"),p=document.getElementById("register-endereco"),m=document.getElementById("register-cpf"),l=document.getElementById("update-name"),i=document.getElementById("update-email"),v=document.getElementById("update-celular"),g=document.getElementById("update-endereco"),s=document.getElementById("update-cpf"),X=document.getElementById("add-user-btn"),Y=document.querySelectorAll(".btn-secondary"),Z=document.querySelectorAll(".close-modal-btn"),tt=S.querySelector(".btn-primary"),O=document.getElementById("toggle-nav"),b=document.getElementById("navbar"),T=document.getElementById("profile-button"),x=document.getElementById("profile-modal"),et=document.querySelector(".name"),at=document.querySelector(".email"),$=document.querySelector(".role"),it=document.getElementById("logout-button"),w=document.getElementById("icon_modal"),J=document.getElementById("text_modal"),h=(t,o=1)=>{F.innerHTML="";const a=(o-1)*D,r=a+D,c=t.slice(a,r);if(c.length===0&&o>1){u=Math.max(1,u-1),h(t,u);return}c.forEach(e=>{const j=F.insertRow();j.innerHTML=`
      <td data-label="Nome">${e.name}</td>
      <td data-label="Email"><div class="editable-cell" contenteditable="true">${e.email}</div></td>
      <td data-label="Celular">${e.telephone}</td>
      <td data-label="Endereço">${e.address}</td>
      <td data-label="CPF">${e.cpf}</td>
      <td data-label="Ações">
        <button class="action-btn edit-btn" data-id="${e.id}">
          <span class="material-icons-outlined">edit</span>
        </button>
        <button class="action-btn delete-btn" data-id="${e.id}">
          <span class="material-icons-outlined">delete</span>
        </button>
      </td>
    `}),t.length===0?(B.style.display="block",B.textContent="Nenhum locatário encontrado.",I.innerHTML=""):(B.style.display="none",ot(t))},ot=t=>{const o=Math.ceil(t.length/D);I.innerHTML="";const a=document.createElement("button");a.innerText="Anterior",a.disabled=u===1,a.classList.add("page-btn"),a.addEventListener("click",()=>{u--,h(t,u)}),I.appendChild(a);for(let c=1;c<=o;c++){const e=document.createElement("button");e.innerText=c,e.classList.add("page-btn"),c===u&&e.classList.add("active"),e.addEventListener("click",()=>{u=c,h(t,u)}),I.appendChild(e)}const r=document.createElement("button");r.innerText="Próximo",r.disabled=u===o,r.classList.add("page-btn"),r.addEventListener("click",()=>{u++,h(t,u)}),I.appendChild(r)},L=t=>{H.classList.add("is-open"),t.classList.add("is-open")},C=t=>{t.classList.remove("is-open"),H.classList.remove("is-open"),E=null,k=null,R.reset(),_.reset()},M=async()=>{try{f=await Q(),h(f,u)}catch(t){console.error("Erro ao carregar locatários:",t),B.style.display="block",B.textContent="Erro ao carregar locatários."}};document.addEventListener("DOMContentLoaded",async()=>{await M(),et.textContent=localStorage.getItem("nameUser"),at.textContent=localStorage.getItem("emailUser"),P()==="ADMIN"?$.textContent="Usuário Editor":$.textContent="Usuário Leitor",V.addEventListener("input",()=>{const t=V.value.toLowerCase().trim(),o=f.filter(a=>a.name.toLowerCase().includes(t)||a.email.toLowerCase().includes(t)||a.telephone.toLowerCase().includes(t)||a.address.toLowerCase().includes(t)||a.cpf.toLowerCase().includes(t));u=1,h(o,u)}),it.addEventListener("click",t=>{t.preventDefault(),localStorage.removeItem("token"),localStorage.removeItem("nameUser"),localStorage.removeItem("emailUser"),localStorage.removeItem("roleUser"),window.location.href="/index.html"}),X.addEventListener("click",()=>{P()==="ADMIN"&&L(N)}),Y.forEach(t=>t.addEventListener("click",o=>C(o.target.closest(".modal")))),Z.forEach(t=>t.addEventListener("click",o=>C(o.target.closest(".modal")))),d.addEventListener("input",()=>{d.value.trim().length<3||d.value.trim().length>30?d.setCustomValidity("Por favor, insira um nome válido."):d.setCustomValidity("")}),n.addEventListener("input",()=>{n.validity.typeMismatch||n.value.trim().length<7||n.value.trim().length>50?n.setCustomValidity("Por favor, insira um email válido."):n.setCustomValidity("")}),y.addEventListener("input",()=>{y.value.trim().length<11||y.value.trim().length>16?y.setCustomValidity("Por favor, insira um celular válido"):y.setCustomValidity("")}),p.addEventListener("input",()=>{p.value.trim().length<3||p.value.trim().length>50?p.setCustomValidity("Por favor, insira um Endereco válido"):p.setCustomValidity("")}),m.addEventListener("input",()=>{m.value.trim().length<11||m.value.trim().length>14?m.setCustomValidity("Por favor, insira um CPF válido"):m.setCustomValidity("")}),R.addEventListener("submit",async t=>{if(t.preventDefault(),!d.value.trim()){d.setCustomValidity("O nome é obrigatório."),d.reportValidity();return}if(!n.value.trim()){n.setCustomValidity("O email é obrigatório."),n.reportValidity();return}if(!y.value.trim()){y.setCustomValidity("O celular é obrigatório."),y.reportValidity();return}if(!p.value.trim()){p.setCustomValidity("O endereço é obrigatório."),p.reportValidity();return}if(!m.value.trim()){m.setCustomValidity("O CPF é obrigatório."),m.reportValidity();return}if(d.value.trim().length<3||d.value.trim().length>30){d.setCustomValidity("Por favor, insira um nome válido."),d.reportValidity();return}if(n.validity.typeMismatch||n.value.trim().length<7||n.value.trim().length>50){n.setCustomValidity("Por favor, insira um email válido."),n.reportValidity();return}if(y.value.trim().length<11||y.value.trim().length>16){y.setCustomValidity("Por favor, insira um celular válido"),y.reportValidity();return}if(p.value.trim().length<3||p.value.trim().length>50){p.setCustomValidity("Por favor, insira um Endereco válido"),p.reportValidity();return}if(m.value.trim().length<11||m.value.trim().length>14){m.setCustomValidity("Por favor, insira um CPF válido"),m.reportValidity();return}const o=f.some(e=>e.name.toLowerCase()===d.value.trim().toLowerCase()),a=f.some(e=>e.email.toLowerCase()===n.value.trim().toLowerCase()),r=f.some(e=>e.cpf.toLowerCase()===m.value.trim().toLowerCase());if(o){d.setCustomValidity("Já existe um locatário cadastrado com esse nome."),d.reportValidity();return}if(a){n.setCustomValidity("Já existe um locatário cadastrado com esse email."),n.reportValidity();return}if(r){m.setCustomValidity("Já existe um locatário com esse CPF."),m.reportValidity();return}const c={name:d.value.trim(),email:n.value.trim(),telephone:y.value.trim(),address:p.value.trim(),cpf:m.value.trim()};console.log(c);try{await G(c),C(N),L(U),setTimeout(()=>C(U),1500),await M(),V.value="",u=1}catch(e){console.error("Erro ao cadastrar locatário:",e.message),alert(e.message)}}),l.addEventListener("input",()=>{l.value.trim().length<3||l.value.trim().length>30?l.setCustomValidity("Por favor, insira um nome válido."):l.setCustomValidity("")}),i.addEventListener("input",()=>{i.validity.typeMismatch||i.value.trim().length<7||i.value.trim().length>50?i.setCustomValidity("Por favor, insira um email válido."):i.setCustomValidity("")}),v.addEventListener("input",()=>{v.value.trim().length<11||v.value.trim().length>16?v.setCustomValidity("Por favor, insira um celular válido"):v.setCustomValidity("")}),g.addEventListener("input",()=>{g.value.trim().length<3||g.value.trim().length>50?g.setCustomValidity("Por favor, insira um Endereco válido"):g.setCustomValidity("")}),s.addEventListener("input",()=>{s.value.trim().length<11||s.value.trim().length>14?s.setCustomValidity("Por favor, insira um CPF válido"):s.setCustomValidity("")}),_.addEventListener("submit",async t=>{if(t.preventDefault(),E===null)return;if(!l.value.trim()){l.setCustomValidity("O nome é obrigatório."),l.reportValidity();return}if(!i.value.trim()){i.setCustomValidity("O email é obrigatório."),i.reportValidity();return}if(!v.value.trim()){v.setCustomValidity("O celular é obrigatório."),v.reportValidity();return}if(!g.value.trim()){g.setCustomValidity("O endereço é obrigatório."),g.reportValidity();return}if(!s.value.trim()){s.setCustomValidity("O CPF é obrigatório."),s.reportValidity();return}if(l.value.trim().length<3||l.value.trim().length>30){l.setCustomValidity("Por favor, insira um nome válido."),l.reportValidity();return}if(i.validity.typeMismatch||i.value.trim().length<7||i.value.trim().length>50){i.setCustomValidity("Por favor, insira um email válido."),i.reportValidity();return}if(v.value.trim().length<11||v.value.trim().length>16){v.setCustomValidity("Por favor, insira um celular válido"),v.reportValidity();return}if(g.value.trim().length<3||g.value.trim().length>50){g.setCustomValidity("Por favor, insira um Endereco válido"),g.reportValidity();return}if(s.value.trim().length<11||s.value.trim().length>14){s.setCustomValidity("Por favor, insira um CPF válido"),s.reportValidity();return}const o=f.some(e=>e.id!==E&&e.name.toLowerCase()===l.value.trim().toLowerCase()),a=f.some(e=>e.id!==E&&e.email.toLowerCase()===i.value.trim().toLowerCase()),r=f.some(e=>e.id!==E&&e.cpf.toLowerCase()===s.value.trim().toLowerCase());if(o){l.setCustomValidity("Já existe um locatário cadastrado com esse nome."),l.reportValidity();return}if(a){i.setCustomValidity("Já existe um locatário cadastrado com esse email."),i.reportValidity();return}if(r){s.setCustomValidity("Já existe um locatário com esse CPF."),s.reportValidity();return}const c={name:l.value.trim(),email:i.value.trim(),telephone:v.value.trim(),address:g.value.trim(),cpf:s.value.trim()};try{await W(E,c),C(z),L(q),setTimeout(()=>C(q),1500),await M(),V.value=""}catch(e){console.error("Erro ao atualizar locatário:",e),alert(e.message)}}),F.addEventListener("click",t=>{const o=t.target.closest(".edit-btn"),a=t.target.closest(".delete-btn");if(o){if(P()!=="ADMIN")return;E=parseInt(o.dataset.id,10);const r=f.find(c=>c.id===E);r&&(l.value=r.name,i.value=r.email,v.value=r.telephone,g.value=r.address,s.value=r.cpf,L(z))}if(a){if(P()!=="ADMIN")return;k=parseInt(a.dataset.id,10),L(S)}}),tt.addEventListener("click",async()=>{if(k!==null)try{await K(k),J.textContent="Locatário excluído!",w.textContent="check_circle",w.style.color="rgb(24, 209, 24)",C(S),L(A),setTimeout(()=>C(A),1500),await M(),V.value=""}catch{J.textContent="Locatário vinculado.",w.textContent="cancel",w.style.color="red",C(S),L(A)}}),O&&b&&(O.addEventListener("click",t=>{t.stopPropagation(),b.classList.toggle("active")}),document.addEventListener("click",t=>{b.classList.contains("active")&&!b.contains(t.target)&&t.target!==O&&b.classList.remove("active")})),T&&x&&(T.addEventListener("click",()=>{x.classList.toggle("visible")}),document.addEventListener("click",t=>{!T.contains(t.target)&&!x.contains(t.target)&&x.classList.remove("visible")}))});
