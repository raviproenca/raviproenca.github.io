import{a as l}from"./index-C1WVuFIU.js";const u="https://locadora-ryan-back.altislabtech.com.br",m=()=>localStorage.getItem("token"),Z=async t=>{const e=m();if(!e)throw new Error("Token de autenticação não encontrado.");try{return(await l.get(`${u}/dashboard/bookMoreRented`,{params:{numberOfMonths:t},headers:{Authorization:`Bearer ${e}`}})).data}catch(a){g(a)}},c=async t=>{const e=m();if(!e)throw new Error("Token de autenticação não encontrado.");try{return(await l.get(`${u}/dashboard/deliveredInTimeQuantity`,{params:{numberOfMonths:t},headers:{Authorization:`Bearer ${e}`}})).data}catch(a){g(a)}},d=async t=>{const e=m();if(!e)throw new Error("Token de autenticação não encontrado.");try{return(await l.get(`${u}/dashboard/deliveredWithDelayQuantity`,{params:{numberOfMonths:t},headers:{Authorization:`Bearer ${e}`}})).data}catch(a){g(a)}},_=async t=>{const e=m();if(!e)throw new Error("Token de autenticação não encontrado.");try{return(await l.get(`${u}/dashboard/rentsLateQuantity`,{params:{numberOfMonths:t},headers:{Authorization:`Bearer ${e}`}})).data}catch(a){g(a)}},G=async()=>{const t=m();if(!t)throw new Error("Token de autenticação não encontrado.");try{const e=await l.get(`${u}/dashboard/rentsPerRenter`,{headers:{Authorization:`Bearer ${t}`}});return console.log(e.data.content),e.data.content}catch(e){g(e)}},H=async t=>{const e=m();if(!e)throw new Error("Token de autenticação não encontrado.");try{return(await l.get(`${u}/dashboard/rentsQuantity`,{params:{numberOfMonths:t},headers:{Authorization:`Bearer ${e}`}})).data}catch(a){g(a)}},g=t=>{throw t.response?new Error(t.response.data?.message||"Erro de resposta da API."):t.request?new Error("Sem resposta do servidor. Verifique sua conexão."):new Error("Erro ao realizar requisição: "+t.message)},R=document.getElementById("register-locatario"),V=document.getElementById("toggle-nav"),f=document.getElementById("navbar"),S=document.getElementById("profile-button"),v=document.getElementById("profile-modal"),j=document.querySelector(".name"),J=document.querySelector(".email"),$=document.querySelector(".role"),K=document.getElementById("logout-button");let E=[],r=[];const X=()=>localStorage.getItem("roleUser"),Y=t=>{t.innerHTML="<option>selecione</option>",E.forEach(e=>{const a=document.createElement("option");a.value=e.name,a.textContent=e.name,t.appendChild(a)})},tt=async()=>{try{E=await G(),Y(R)}catch(t){console.error("Erro ao carregar locatários:",t)}},et=async()=>{try{r=await Z(12)}catch(t){console.error("Erro ao carregar livros:",t)}};document.addEventListener("DOMContentLoaded",async()=>{await et(),await tt(),j.textContent=localStorage.getItem("nameUser"),J.textContent=localStorage.getItem("emailUser"),X()==="ADMIN"?$.textContent="Usuário Editor":$.textContent="Usuário Leitor",K.addEventListener("click",o=>{o.preventDefault(),localStorage.removeItem("token"),localStorage.removeItem("nameUser"),localStorage.removeItem("emailUser"),localStorage.removeItem("roleUser"),window.location.href="/index.html"}),document.getElementById("mais-alugado").textContent=r[0].name,document.getElementById("segundo-mais-alugado").textContent=r[1].name,document.getElementById("terceiro-mais-alugado").textContent=r[2].name,document.getElementById("mais-alugado-number").textContent=`${r[0].totalRents}x`,document.getElementById("segundo-mais-alugado-number").textContent=`${r[1].totalRents}x`,document.getElementById("terceiro-mais-alugado-number").textContent=`${r[2].totalRents}x`,document.getElementById("emprestado-number").textContent=await H(1),document.getElementById("atrasado-number").textContent=await _(1);const t=await c(2),e=await c(4),a=await c(7),z=await c(10),F=await c(12),A=await d(2),x=await d(4),B=await d(7),I=await d(10),T=await d(12),D=await c(99),M=await d(99),U=document.getElementById("locatarios-chart-pie").getContext("2d"),Q=document.getElementById("livros-chart-bar").getContext("2d"),k="#A7ED4A",C="#9B59B6",N=[t,e-t,a-e,z-a,F-z],O=[A,x-A,B-x,I-B,T-I],L=window.matchMedia("(max-width: 480px)"),y=L.matches,q=y?11:14,W=y?10:20;let p=null;R.addEventListener("change",o=>{const n=o.target.value,s=E.find(h=>h.name===n);p&&(p.data.datasets[0].data=[s.rentsActive,s.rentsQuantity],p.update())}),p=new Chart(U,{type:"doughnut",data:{labels:["Livros alugados no momento","Total de aluguéis realizados"],datasets:[{label:"Status dos Livros",data:[1,1],backgroundColor:[k,C],borderColor:[k,C],borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,cutout:"70%",animation:{animateRotate:!0,animateScale:!0,duration:1200},plugins:{legend:{position:"bottom",labels:{color:"#fff",font:{size:q,weight:700},padding:W,boxWidth:14}},tooltip:{enabled:!0,callbacks:{label:function(o){let n=o.label||"";if(n&&(n+=": "),o.parsed!==null){const s=o.dataset.data.reduce((i,w)=>i+w,0),h=(o.parsed/s*100).toFixed(1);n+=o.parsed+" ("+h+"%)"}return n}}},title:{display:!1}}}});let b;const P=async o=>{b&&b.destroy();const n=o?10:14,s=o?12:16,h=o?25:15;b=new Chart(Q,{type:"bar",data:{labels:["2025","2024","2023","2022","2021"],datasets:[{label:"No Prazo",data:N,backgroundColor:"#00C9FF",borderRadius:6},{label:"Fora do Prazo",data:O,backgroundColor:"#FF7F00",borderRadius:6}]},options:{indexAxis:o?"x":"y",responsive:!0,maintainAspectRatio:!1,animation:{duration:1e3,easing:"easeOutQuart"},plugins:{legend:{display:!0,position:"bottom",labels:{color:"#fff",boxWidth:12,padding:15,font:{size:n,weight:700}}},tooltip:{callbacks:{label:i=>{const w=i.chart.options.indexAxis==="y"?i.parsed.x:i.parsed.y;return`${i.dataset.label}: ${w}`}}},subtitle:{display:!0,text:`Total devolvidos no prazo: ${D}    |    Devolvidos com atraso: ${M}`,color:"#fff",font:{size:s,weight:700},padding:{bottom:h}},datalabels:{display:!1}},scales:{x:{beginAtZero:!0,grid:{display:!1,drawBorder:!1},ticks:{color:"#fff"}},y:{beginAtZero:!0,grid:{display:!1,drawBorder:!1},ticks:{color:"#fff"}}}},plugins:[ChartDataLabels]})};await P(y),L.addEventListener("change",async o=>{await P(o.matches)}),V.addEventListener("click",o=>{o.stopPropagation(),f.classList.toggle("active")}),document.addEventListener("click",o=>{f.classList.contains("active")&&!f.contains(o.target)&&f.classList.remove("active")}),S.addEventListener("click",()=>{v.classList.toggle("visible")}),document.addEventListener("click",o=>{!S.contains(o.target)&&!v.contains(o.target)&&v.classList.remove("visible")})});
