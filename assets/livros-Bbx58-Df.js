import"./index-C1WVuFIU.js";/* empty css              */import{c as W,e as X,f as Y,a as tt}from"./livrosService-D_eR0hs1.js";import{f as et}from"./editorasService-CdElC3Hq.js";const N=6;let r=1,S=[],L=null,x=null,q=[];const V=()=>localStorage.getItem("roleUser"),O=document.querySelector("#users-table tbody"),b=document.getElementById("pagination"),I=document.getElementById("search-input"),B=document.getElementById("mensagem-erro"),Z=document.getElementById("modal-overlay"),U=document.getElementById("modal-cadastrar"),z=document.getElementById("modal-atualizar"),$=document.getElementById("modal-cadastrando"),Q=document.getElementById("modal-atualizando"),M=document.getElementById("modal-confirmando"),k=document.getElementById("modal-deletando"),F=document.getElementById("form-cadastrar"),j=document.getElementById("form-atualizar"),m=document.getElementById("register-name"),c=document.getElementById("register-autor"),p=document.getElementById("register-lancamento"),s=document.getElementById("register-estoque"),C=document.getElementById("register-editora"),u=document.getElementById("update-name"),d=document.getElementById("update-autor"),y=document.getElementById("update-lancamento"),l=document.getElementById("update-estoque"),f=document.getElementById("update-editora"),at=document.getElementById("add-user-btn"),ot=document.querySelectorAll(".btn-secondary"),nt=document.querySelectorAll(".close-modal-btn"),rt=M.querySelector(".btn-primary"),P=document.getElementById("toggle-nav"),h=document.getElementById("navbar"),T=document.getElementById("profile-button"),D=document.getElementById("profile-modal"),it=document.querySelector(".name"),lt=document.querySelector(".email"),H=document.querySelector(".role"),st=document.getElementById("logout-button"),w=document.getElementById("icon_modal"),R=document.getElementById("text_modal"),E=(t,o=1)=>{O.innerHTML="";const a=(o-1)*N,n=a+N,i=t.slice(a,n);if(i.length===0&&o>1){r=Math.max(1,r-1),E(t,r);return}i.forEach(e=>{const G=q.find(K=>K.id===e.publisher.id),J=O.insertRow();J.innerHTML=`
      <td data-label="Nome">${e.name}</td>
      <td data-label="Autor">${e.author}</td>
      <td data-label="Editora">${G.name}</td>
      <td data-label="Lançamento">${new Date(e.launchDate).toLocaleDateString("pt-BR",{timeZone:"UTC"})}</td>
      <td data-label="Estoque">${e.totalQuantity}</td>
      <td data-label="Alugados">${e.totalInUse}</td>
      <td data-label="Ações">
        <button class="action-btn edit-btn" data-id="${e.id}">
          <span class="material-icons-outlined">edit</span>
        </button>
        <button class="action-btn delete-btn" data-id="${e.id}">
          <span class="material-icons-outlined">delete</span>
        </button>
      </td>
    `}),t.length===0?(B.style.display="block",B.textContent="Nenhum livro encontrado.",b.innerHTML=""):(B.style.display="none",dt(t))},dt=t=>{const o=Math.ceil(t.length/N);b.innerHTML="";const a=document.createElement("button");a.innerText="Anterior",a.disabled=r===1,a.classList.add("page-btn"),a.addEventListener("click",()=>{r--,E(t,r)}),b.appendChild(a);for(let i=1;i<=o;i++){const e=document.createElement("button");e.innerText=i,e.classList.add("page-btn"),i===r&&e.classList.add("active"),e.addEventListener("click",()=>{r=i,E(t,r)}),b.appendChild(e)}const n=document.createElement("button");n.innerText="Próximo",n.disabled=r===o,n.classList.add("page-btn"),n.addEventListener("click",()=>{r++,E(t,r)}),b.appendChild(n)},_=t=>{t.innerHTML='<option value="">Selecione uma Editora</option>',q.forEach(o=>{const a=document.createElement("option");a.value=o.id,a.textContent=o.name,t.appendChild(a)})},A=async()=>{try{S=await Y(),E(S,r)}catch(t){console.error("Erro ao buscar livros:",t),B.style.display="block",B.textContent="Erro ao carregar livros."}},ct=async()=>{try{q=await et(),_(C),_(f)}catch(t){console.error("Erro ao carregar editoras:",t)}},g=t=>{Z.classList.add("is-open"),t.classList.add("is-open")},v=t=>{t.classList.remove("is-open"),Z.classList.remove("is-open"),L=null,x=null,F.reset(),j.reset()};document.addEventListener("DOMContentLoaded",async()=>{await ct(),await A(),it.textContent=localStorage.getItem("nameUser"),lt.textContent=localStorage.getItem("emailUser"),V()==="ADMIN"?H.textContent="Usuário Editor":H.textContent="Usuário Leitor",I.addEventListener("input",()=>{const t=I.value.toLowerCase().trim(),o=S.filter(a=>{const n=new Date(a.launchDate).toLocaleDateString("pt-BR",{timeZone:"UTC"});return a.name.toLowerCase().includes(t)||a.author.toLowerCase().includes(t)||n.includes(t)||String(a.totalQuantity).includes(t)||a.publisher.name.toLowerCase().includes(t)});r=1,E(o,r)}),st.addEventListener("click",t=>{t.preventDefault(),localStorage.removeItem("token"),localStorage.removeItem("nameUser"),localStorage.removeItem("emailUser"),localStorage.removeItem("roleUser"),window.location.href="/index.html"}),at.addEventListener("click",()=>{V()==="ADMIN"&&g(U)}),ot.forEach(t=>t.addEventListener("click",o=>v(o.target.closest(".modal")))),nt.forEach(t=>t.addEventListener("click",o=>v(o.target.closest(".modal")))),m.addEventListener("input",()=>{m.value.trim().length<3||m.value.trim().length>30?m.setCustomValidity("Por favor, insira um nome válido."):m.setCustomValidity("")}),c.addEventListener("input",()=>{c.validity.typeMismatch||c.value.trim().length<3||c.value.trim().length>50?c.setCustomValidity("Por favor, insira um nome de autor válido."):c.setCustomValidity("")}),s.addEventListener("input",()=>{parseInt(s.value.trim())<0?s.setCustomValidity("O estoque deve ser um número positivo."):s.setCustomValidity("")}),F.addEventListener("submit",async t=>{if(t.preventDefault(),!m.value.trim()){m.setCustomValidity("O nome é obrigatório."),m.reportValidity();return}if(!c.value.trim()){c.setCustomValidity("O autor é obrigatório."),c.reportValidity();return}const o=parseInt(C.value,10);if(isNaN(o)){C.setCustomValidity("A editora é obrigatória."),C.reportValidity();return}if(!p.value.trim()){p.setCustomValidity("A data de lançamento é obrigatória."),p.reportValidity();return}if(new Date(p.value)>new Date){p.setCustomValidity("A data de lançamento não pode ser no futuro."),p.reportValidity();return}if(!s.value.trim()){s.setCustomValidity("O estoque é obrigatório"),s.reportValidity();return}if(parseInt(s.value.trim())<0){s.setCustomValidity("O estoque deve ser um número positivo."),s.reportValidity();return}const i={name:m.value.trim(),author:c.value.trim(),launchDate:p.value,totalQuantity:parseInt(s.value,10),publisherId:parseInt(C.value,10)};console.log(i);try{await W(i),v(U),g($),setTimeout(()=>v($),1500),await A(),I.value="",r=1}catch(e){console.error("Erro ao cadastrar livro:",e),alert(e.message||"Erro ao cadastrar livro.")}}),u.addEventListener("input",()=>{u.value.trim().length<3||u.value.trim().length>30?u.setCustomValidity("Por favor, insira um nome válido."):u.setCustomValidity("")}),d.addEventListener("input",()=>{d.validity.typeMismatch||d.value.trim().length<3||d.value.trim().length>50?d.setCustomValidity("Por favor, insira um nome de autor válido."):d.setCustomValidity("")}),l.addEventListener("input",()=>{parseInt(l.value.trim())<0?l.setCustomValidity("O estoque deve ser um número positivo."):l.setCustomValidity("")}),j.addEventListener("submit",async t=>{if(t.preventDefault(),L===null)return;if(!u.value.trim()){u.setCustomValidity("O nome é obrigatório."),u.reportValidity();return}if(!d.value.trim()){d.setCustomValidity("O autor é obrigatório."),d.reportValidity();return}const o=parseInt(f.value,10);if(isNaN(o)){f.setCustomValidity("A editora é obrigatória."),f.reportValidity();return}if(!y.value.trim()){y.setCustomValidity("A data de lançamento é obrigatória."),y.reportValidity();return}if(new Date(y.value)>new Date){y.setCustomValidity("A data de lançamento não pode ser no futuro."),y.reportValidity();return}if(!l.value.trim()){l.setCustomValidity("O estoque é obrigatório"),l.reportValidity();return}if(parseInt(l.value.trim())<0){l.setCustomValidity("O estoque deve ser um número positivo."),l.reportValidity();return}const i={name:u.value.trim(),author:d.value.trim(),launchDate:y.value,totalQuantity:parseInt(l.value,10),publisherId:parseInt(f.value,10)};try{await tt(L,i),v(z),g(Q),setTimeout(()=>v(Q),1500),await A(),I.value=""}catch(e){console.error("Erro ao atualizar livro:",e),alert(e.message||"Erro ao atualizar livro.")}}),O.addEventListener("click",t=>{const o=t.target.closest(".edit-btn"),a=t.target.closest(".delete-btn");if(o){if(V()!=="ADMIN")return;L=parseInt(o.dataset.id,10);const n=S.find(e=>e.id===L),i=q.find(e=>e.id===n.publisher.id);n&&(u.value=n.name,d.value=n.author,y.value=n.launchDate,l.value=n.totalQuantity,f.value=i.id,g(z))}if(a){if(V()!=="ADMIN")return;x=parseInt(a.dataset.id,10),g(M)}}),rt.addEventListener("click",async()=>{if(x!==null)try{await X(x),R.textContent="Livro excluído!",w.textContent="check_circle",w.style.color="rgb(24, 209, 24)",v(M),g(k),setTimeout(()=>v(k),1500),await A(),I.value=""}catch{R.textContent="Livro vinculado.",w.textContent="cancel",w.style.color="red",v(M),g(k)}}),P&&h&&(P.addEventListener("click",t=>{t.stopPropagation(),h.classList.toggle("active")}),document.addEventListener("click",t=>{h.classList.contains("active")&&!h.contains(t.target)&&t.target!==P&&h.classList.remove("active")})),T&&D&&(T.addEventListener("click",()=>{D.classList.toggle("visible")}),document.addEventListener("click",t=>{!T.contains(t.target)&&!D.contains(t.target)&&D.classList.remove("visible")}))});
