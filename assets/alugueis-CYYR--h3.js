import{a as C}from"./index-C1WVuFIU.js";/* empty css              */import{f as X}from"./livrosService-D_eR0hs1.js";import{f as tt}from"./locatariosService-BxzGqk0_.js";const T="https://locadora-ryan-back.altislabtech.com.br",S=()=>localStorage.getItem("token"),et=async()=>{const t=S();if(!t)throw new Error("Token de autenticação não encontrado.");try{return(await C.get(`${T}/rent`,{headers:{Authorization:`Bearer ${t}`}})).data}catch(o){V(o)}},ot=async t=>{const o=S();if(!o)throw new Error("Token de autenticação não encontrado.");try{return(await C.post(`${T}/rent`,t,{headers:{Authorization:`Bearer ${o}`}})).data}catch(e){V(e)}},at=async(t,o)=>{const e=S();if(!e)throw new Error("Token de autenticação não encontrado.");try{return(await C.put(`${T}/rent/update/${t}`,o,{headers:{Authorization:`Bearer ${e}`}})).data}catch(n){V(n)}},nt=async(t,o)=>{const e=S();if(!e)throw new Error("Token de autenticação não encontrado.");try{return(await C.put(`${T}/rent/${t}`,o,{headers:{Authorization:`Bearer ${e}`}})).data}catch(n){V(n)}},V=t=>{throw t.response?new Error(t.response.data?.message||"Erro de resposta da API."):t.request?new Error("Sem resposta do servidor. Verifique sua conexão."):new Error("Erro ao realizar requisição: "+t.message)},k=6;let s=1,f=[],E=null,A=null,x=[],M=[];const D=()=>localStorage.getItem("roleUser"),R=document.querySelector("#users-table tbody"),y=document.getElementById("pagination"),g=document.getElementById("search-input"),b=document.getElementById("mensagem-erro"),Y=document.getElementById("modal-overlay"),P=document.getElementById("modal-cadastrar"),_=document.getElementById("modal-atualizar"),q=document.getElementById("modal-cadastrando"),H=document.getElementById("modal-atualizando"),U=document.getElementById("modal-confirmando"),O=document.getElementById("modal-deletando"),j=document.getElementById("form-cadastrar"),G=document.getElementById("form-atualizar"),I=document.getElementById("register-livro"),L=document.getElementById("register-locatario"),l=document.getElementById("register-data-entrega"),m=document.getElementById("update-livro"),p=document.getElementById("update-locatario"),d=document.getElementById("update-data-entrega"),rt=document.getElementById("add-user-btn"),st=document.querySelectorAll(".btn-secondary"),it=document.querySelectorAll(".close-modal-btn"),dt=U.querySelector(".btn-primary"),z=document.getElementById("toggle-nav"),v=document.getElementById("navbar"),$=document.getElementById("profile-button"),B=document.getElementById("profile-modal"),ct=document.querySelector(".name"),lt=document.querySelector(".email"),Z=document.querySelector(".role"),ut=document.getElementById("logout-button"),h=(t,o=1)=>{R.innerHTML="";const e=(o-1)*k,n=e+k;t.slice(e,n).forEach(a=>{const r=x.find(N=>N.id===a.book.id),J=M.find(N=>N.id===a.renter.id),K=R.insertRow(),Q=a.status==="DELIVERED_WITH_DELAY"||a.status==="IN_TIME"?"action-btn returned-btn active":"action-btn returned-btn";K.innerHTML=`
      <td data-label="Livro">${r.name}</td>
      <td data-label="Locatário">${J.name}</td>
      <td data-label="Data de Locação">${new Date(a.rentDate).toLocaleDateString("pt-BR",{timeZone:"UTC"})}</td>
      <td data-label="Data de Devolução">${a.devolutionDate?new Date(a.devolutionDate).toLocaleDateString("pt-BR",{timeZone:"UTC"}):"Aluguel em andamento"}</td>
      <td data-label="Status">${a.status==="LATE"?"Atrasado":a.status==="DELIVERED_WITH_DELAY"?"Devolvido com atraso":a.status==="IN_TIME"?"Devolvido no prazo":"Em dia"}</td>
      <td data-label="Ações">
        <button class="action-btn edit-btn" data-id="${a.id}">
          <span class="material-icons-outlined">edit</span>
        </button>
        <button class="action-btn ${Q}" data-id="${a.id}">
          <span class="material-icons-outlined">check_box</span>
        </button>
      </td>
    `}),t.length===0?(b.style.display="block",b.textContent="Nenhum aluguel encontrado.",y.innerHTML=""):(b.style.display="none",mt(t))},mt=t=>{const o=Math.ceil(t.length/k);y.innerHTML="";const e=document.createElement("button");e.innerText="Anterior",e.disabled=s===1,e.classList.add("page-btn"),e.addEventListener("click",()=>{s--,h(t,s)}),y.appendChild(e);for(let i=1;i<=o;i++){const a=document.createElement("button");a.innerText=i,a.classList.add("page-btn"),i===s&&a.classList.add("active"),a.addEventListener("click",()=>{s=i,h(t,s)}),y.appendChild(a)}const n=document.createElement("button");n.innerText="Próximo",n.disabled=s===o,n.classList.add("page-btn"),n.addEventListener("click",()=>{s++,h(t,s)}),y.appendChild(n)},F=t=>{t.innerHTML='<option value="">Selecione um Livro</option>',x.forEach(o=>{const e=document.createElement("option");e.value=o.id,e.textContent=o.name,t.appendChild(e)})},W=t=>{t.innerHTML='<option value="">Selecione um Locatário</option>',M.forEach(o=>{const e=document.createElement("option");e.value=o.id,e.textContent=o.name,t.appendChild(e)})},w=async()=>{try{f=await et(),h(f,s)}catch(t){console.error("Erro ao carregar aluguéis:",t),b.style.display="block",b.textContent="Erro ao carregar aluguéis."}},pt=async()=>{try{x=await X(),F(I),F(m)}catch(t){console.error("Erro ao carregar livros:",t)}},gt=async()=>{try{M=await tt(),W(L),W(p)}catch(t){console.error("Erro ao carregar locatários:",t)}},u=t=>{Y.classList.add("is-open"),t.classList.add("is-open")},c=t=>{t.classList.remove("is-open"),Y.classList.remove("is-open"),E=null,A=null,j.reset(),G.reset()};document.addEventListener("DOMContentLoaded",async()=>{await pt(),await gt(),await w(),ct.textContent=localStorage.getItem("nameUser"),lt.textContent=localStorage.getItem("emailUser"),D()==="ADMIN"?Z.textContent="Usuário Editor":Z.textContent="Usuário Leitor",g.addEventListener("input",()=>{const t=g.value.toLowerCase().trim(),o=f.filter(e=>{const n=e.status==="LATE"?"Atrasado":e.status==="DELIVERED_WITH_DELAY"?"Devolvido com atraso":e.status==="IN_TIME"?"Devolvido no prazo":"Em dia",i=new Date(e.rentDate).toLocaleDateString("pt-BR",{timeZone:"UTC"}),a=e.devolutionDate?new Date(e.devolutionDate).toLocaleDateString("pt-BR",{timeZone:"UTC"}):"";return e.book.name.toLowerCase().includes(t)||e.renter.name.toLowerCase().includes(t)||i.includes(t)||a.includes(t)||n.toLowerCase().includes(t)});s=1,h(o,s)}),ut.addEventListener("click",t=>{t.preventDefault(),localStorage.removeItem("token"),localStorage.removeItem("nameUser"),localStorage.removeItem("emailUser"),localStorage.removeItem("roleUser"),window.location.href="/index.html"}),rt.addEventListener("click",()=>{D()==="ADMIN"&&u(P)}),st.forEach(t=>t.addEventListener("click",o=>c(o.target.closest(".modal")))),it.forEach(t=>t.addEventListener("click",o=>c(o.target.closest(".modal")))),j.addEventListener("submit",async t=>{t.preventDefault();const o=parseInt(I.value,10);if(isNaN(o)){I.setCustomValidity("O livro é obrigatório."),I.reportValidity();return}const e=parseInt(L.value,10);if(isNaN(e)){L.setCustomValidity("O locatário é obrigatório."),L.reportValidity();return}if(!l.value.trim()){l.setCustomValidity("A data de entrega é obrigatória."),l.reportValidity();return}if(new Date(l.value)<new Date){l.setCustomValidity("A data de entrega não pode ser no passado."),l.reportValidity();return}const a={renterId:parseInt(L.value,10),bookId:parseInt(I.value,10),deadLine:l.value};try{await ot(a),c(P),u(q),setTimeout(()=>c(q),1500),await w(),g.value="",s=Math.ceil(f.length/k)}catch(r){console.error("Erro ao cadastrar aluguel:",r),alert(r.message)}}),G.addEventListener("submit",async t=>{if(t.preventDefault(),E===null)return;const o=parseInt(m.value,10);if(isNaN(o)){m.setCustomValidity("O livro é obrigatório."),m.reportValidity();return}const e=parseInt(p.value,10);if(isNaN(e)){p.setCustomValidity("O locatário é obrigatório."),p.reportValidity();return}if(!d.value.trim()){d.setCustomValidity("A data de entrega é obrigatória."),d.reportValidity();return}if(new Date(d.value)<new Date){d.setCustomValidity("A data de entrega não pode ser no passado."),d.reportValidity();return}const a={renterId:parseInt(p.value,10),bookId:parseInt(m.value,10),deadLine:d.value};try{await at(E,a),c(_),u(H),setTimeout(()=>c(H),1500),await w(),g.value=""}catch(r){console.error("Erro ao atualizar aluguel:",r),alert(r.message)}}),R.addEventListener("click",t=>{const o=t.target.closest(".returned-btn"),e=t.target.closest(".edit-btn");if(e){if(D()!=="ADMIN")return;E=parseInt(e.dataset.id,10);const n=f.find(r=>r.id===E),i=x.find(r=>r.id===n.book.id),a=M.find(r=>r.id===n.renter.id);n&&(m.value=i.id,p.value=a.id,d.value=n.deadLine,u(_))}if(!o.classList.contains("active")){if(D()!=="ADMIN")return;A=parseInt(o.dataset.id,10),u(U)}}),dt.addEventListener("click",async()=>{if(A!==null)try{await nt(A),c(U),u(O),setTimeout(()=>c(O),1500),await w(),g.value=""}catch(t){console.error("Erro ao finalizar aluguel:",t),alert(t.message)}}),z&&v&&(z.addEventListener("click",t=>{t.stopPropagation(),v.classList.toggle("active")}),document.addEventListener("click",t=>{v.classList.contains("active")&&!v.contains(t.target)&&t.target!==z&&v.classList.remove("active")})),$&&B&&($.addEventListener("click",()=>{B.classList.toggle("visible")}),document.addEventListener("click",t=>{!$.contains(t.target)&&!B.contains(t.target)&&B.classList.remove("visible")}))});
