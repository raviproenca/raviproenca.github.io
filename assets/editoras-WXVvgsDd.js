import"./index-C1WVuFIU.js";/* empty css              */import{c as j,e as F,f as G,a as K}from"./editorasService-CdElC3Hq.js";const A=6;let s=1,y=[],E=null,M=null;const V=()=>localStorage.getItem("roleUser"),D=document.querySelector("#users-table tbody"),b=document.getElementById("pagination"),C=document.getElementById("search-input"),I=document.getElementById("mensagem-erro"),H=document.getElementById("modal-overlay"),z=document.getElementById("modal-cadastrar"),N=document.getElementById("modal-atualizar"),O=document.getElementById("modal-cadastrando"),U=document.getElementById("modal-atualizando"),P=document.getElementById("modal-confirmando"),k=document.getElementById("modal-deletando"),J=document.getElementById("form-cadastrar"),_=document.getElementById("form-atualizar"),l=document.getElementById("register-name"),n=document.getElementById("register-email"),u=document.getElementById("register-telefone"),p=document.getElementById("register-site"),r=document.getElementById("update-name"),i=document.getElementById("update-email"),c=document.getElementById("update-telefone"),g=document.getElementById("update-site"),Q=document.getElementById("add-user-btn"),W=document.querySelectorAll(".btn-secondary"),X=document.querySelectorAll(".close-modal-btn"),Y=P.querySelector(".btn-primary"),S=document.getElementById("toggle-nav"),L=document.getElementById("navbar"),T=document.getElementById("profile-button"),B=document.getElementById("profile-modal"),Z=document.querySelector(".name"),tt=document.querySelector(".email"),q=document.querySelector(".role"),et=document.getElementById("logout-button"),x=document.getElementById("icon_modal"),$=document.getElementById("text_modal"),h=(t,o=1)=>{D.innerHTML="";const a=(o-1)*A,d=a+A,e=t.slice(a,d);if(e.length===0&&o>1){s=Math.max(1,s-1),h(t,s);return}e.forEach(m=>{const R=D.insertRow();R.innerHTML=`
        <td data-label="Nome">${m.name}</td>
        <td data-label="Email"><div class="editable-cell" contenteditable="true">${m.email}</div></td>
        <td data-label="Telefone">${m.telephone}</td>
        <td data-label="Site"><div class="editable-cell" contenteditable="true">${m.site}</div></td>
        <td data-label="Ações">
          <button class="action-btn edit-btn" data-id="${m.id}">
            <span class="material-icons-outlined">edit</span>
          </button>
          <button class="action-btn delete-btn" data-id="${m.id}">
            <span class="material-icons-outlined">delete</span>
          </button>
        </td>
      `}),t.length===0?(I.style.display="block",I.textContent="Nenhuma editora encontrada.",b.innerHTML=""):(I.style.display="none",at(t))},at=t=>{const o=Math.ceil(t.length/A);b.innerHTML="";const a=document.createElement("button");a.innerText="Anterior",a.disabled=s===1,a.classList.add("page-btn"),a.addEventListener("click",()=>{s--,h(t,s)}),b.appendChild(a);for(let e=1;e<=o;e++){const m=document.createElement("button");m.innerText=e,m.classList.add("page-btn"),e===s&&m.classList.add("active"),m.addEventListener("click",()=>{s=e,h(t,s)}),b.appendChild(m)}const d=document.createElement("button");d.innerText="Próximo",d.disabled=s===o,d.classList.add("page-btn"),d.addEventListener("click",()=>{s++,h(t,s)}),b.appendChild(d)},f=t=>{H.classList.add("is-open"),t.classList.add("is-open")},v=t=>{t.classList.remove("is-open"),H.classList.remove("is-open"),E=null,M=null,J.reset(),_.reset()},w=async()=>{try{y=await G(),h(y,s)}catch(t){console.error("Erro ao buscar editoras:",t),I.style.display="block",I.textContent="Erro ao carregar editoras."}};document.addEventListener("DOMContentLoaded",async()=>{await w(),Z.textContent=localStorage.getItem("nameUser"),tt.textContent=localStorage.getItem("emailUser"),V()==="ADMIN"?q.textContent="Usuário Editor":q.textContent="Usuário Leitor",C.addEventListener("input",()=>{const t=C.value.toLowerCase().trim(),o=y.filter(a=>a.name.toLowerCase().includes(t)||a.email.toLowerCase().includes(t)||a.telephone.toLowerCase().includes(t)||a.site.toLowerCase().includes(t));s=1,h(o,s)}),et.addEventListener("click",t=>{t.preventDefault(),localStorage.removeItem("token"),localStorage.removeItem("nameUser"),localStorage.removeItem("emailUser"),localStorage.removeItem("roleUser"),window.location.href="/index.html"}),Q.addEventListener("click",()=>{V()==="ADMIN"&&f(z)}),W.forEach(t=>{t.addEventListener("click",o=>{const a=o.target.closest(".modal");v(a)})}),X.forEach(t=>{t.addEventListener("click",o=>{const a=o.target.closest(".modal");v(a)})}),l.addEventListener("input",()=>{l.value.trim().length<3||l.value.trim().length>30?l.setCustomValidity("Por favor, insira um nome válido."):l.setCustomValidity("")}),n.addEventListener("input",()=>{n.validity.typeMismatch||n.value.trim().length<7||n.value.trim().length>50?n.setCustomValidity("Por favor, insira um email válido."):n.setCustomValidity("")}),u.addEventListener("input",()=>{u.value.trim().length<11||u.value.trim().length>16?u.setCustomValidity("Por favor, insira um telefone válido"):u.setCustomValidity("")}),J.addEventListener("submit",async t=>{if(t.preventDefault(),!l.value.trim()){l.setCustomValidity("O nome é obrigatório."),l.reportValidity();return}if(!n.value.trim()){n.setCustomValidity("O email é obrigatório."),n.reportValidity();return}if(!u.value.trim()){u.setCustomValidity("O telefone é obrigatório."),u.reportValidity();return}if(l.value.trim().length<3||l.value.trim().length>30){l.setCustomValidity("Por favor, insira um nome válido."),l.reportValidity();return}if(n.validity.typeMismatch||n.value.trim().length<7||n.value.trim().length>50){n.setCustomValidity("Por favor, insira um email válido."),n.reportValidity();return}if(u.value.trim().length<11||u.value.trim().length>16){u.setCustomValidity("Por favor, insira um telefone válido"),u.reportValidity();return}if(p.value.trim()!=""&&(p.validity.typeMismatch||p.value.trim().length<16)){p.setCustomValidity("Por favor, insira um site válido"),p.reportValidity();return}const o=y.some(e=>e.name.toLowerCase()===l.value.trim().toLowerCase()),a=y.some(e=>e.email.toLowerCase()===n.value.trim().toLowerCase());if(o){l.setCustomValidity("Já existe uma editora cadastrada com esse nome."),l.reportValidity();return}if(a){n.setCustomValidity("Já existe uma editora cadastrada com esse email."),n.reportValidity();return}const d={name:l.value.trim(),email:n.value.trim(),telephone:u.value.trim(),site:p.value.trim()||""};try{await j(d),v(z),f(O),setTimeout(()=>v(O),1500),await w(),C.value="",s=1}catch(e){console.error("Erro ao cadastrar editora:",e),alert("Erro ao cadastrar editora.")}}),r.addEventListener("input",()=>{r.value.trim().length<3||r.value.trim().length>30?r.setCustomValidity("Por favor, insira um nome válido."):r.setCustomValidity("")}),i.addEventListener("input",()=>{i.validity.typeMismatch||i.value.trim().length<7||i.value.trim().length>50?i.setCustomValidity("Por favor, insira um email válido."):i.setCustomValidity("")}),c.addEventListener("input",()=>{c.value.trim().length<11||c.value.trim().length>16?c.setCustomValidity("Por favor, insira um telefone válido"):c.setCustomValidity("")}),_.addEventListener("submit",async t=>{if(t.preventDefault(),E===null)return;if(!r.value.trim()){r.setCustomValidity("O nome é obrigatório."),r.reportValidity();return}if(!i.value.trim()){i.setCustomValidity("O email é obrigatório."),i.reportValidity();return}if(!c.value.trim()){c.setCustomValidity("O telefone é obrigatório."),c.reportValidity();return}if(r.value.trim().length<3||r.value.trim().length>30){r.setCustomValidity("Por favor, insira um nome válido."),r.reportValidity();return}if(i.validity.typeMismatch||i.value.trim().length<7||i.value.trim().length>50){i.setCustomValidity("Por favor, insira um email válido."),i.reportValidity();return}if(c.value.trim().length<11||c.value.trim().length>16){c.setCustomValidity("Por favor, insira um telefone válido"),c.reportValidity();return}if(g.value.trim()!=""&&(g.validity.typeMismatch||g.value.trim().length<16)){g.setCustomValidity("Por favor, insira um site válido"),g.reportValidity();return}const o=y.some(e=>e.id!==E&&e.name.toLowerCase()===r.value.trim().toLowerCase()),a=y.some(e=>e.id!==E&&e.email.toLowerCase()===i.value.trim().toLowerCase());if(o){r.setCustomValidity("Já existe uma editora cadastrada com esse nome."),r.reportValidity();return}if(a){i.setCustomValidity("Já existe uma editora cadastrada com esse email."),i.reportValidity();return}const d={name:r.value.trim(),email:i.value.trim(),telephone:c.value.trim(),site:g.value.trim()||""};try{await K(E,d),v(N),f(U),setTimeout(()=>v(U),1500),await w(),C.value=""}catch(e){console.error("Erro ao atualizar editora:",e),alert("Erro ao atualizar editora.")}}),D.addEventListener("click",t=>{const o=t.target.closest(".edit-btn"),a=t.target.closest(".delete-btn");if(o){if(V()!=="ADMIN")return;const d=parseInt(o.dataset.id,10);E=d;const e=y.find(m=>m.id===d);e&&(r.value=e.name,i.value=e.email,c.value=e.telephone,g.value=e.site||"",f(N))}if(a){if(V()!=="ADMIN")return;M=parseInt(a.dataset.id,10),f(P)}}),Y.addEventListener("click",async()=>{if(M!==null)try{await F(M),$.textContent="Editora excluída!",x.textContent="check_circle",x.style.color="rgb(24, 209, 24)",v(P),f(k),setTimeout(()=>v(k),1500),await w(),C.value=""}catch{$.textContent="Editora vinculada.",x.textContent="cancel",x.style.color="red",v(P),f(k)}}),S&&L&&(S.addEventListener("click",t=>{t.stopPropagation(),L.classList.toggle("active")}),document.addEventListener("click",t=>{L.classList.contains("active")&&!L.contains(t.target)&&t.target!==S&&L.classList.remove("active")})),T&&B&&(T.addEventListener("click",()=>{B.classList.toggle("visible")}),document.addEventListener("click",t=>{!T.contains(t.target)&&!B.contains(t.target)&&B.classList.remove("visible")}))});
