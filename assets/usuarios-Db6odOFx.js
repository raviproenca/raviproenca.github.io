import{a as k}from"./index-C1WVuFIU.js";/* empty css              */const U="https://locadora-ryan-back.altislabtech.com.br",P=()=>localStorage.getItem("token"),K=async()=>{const e=P();if(!e)throw new Error("Token de autenticação não encontrado.");try{return(await k.get(`${U}/user`,{headers:{Authorization:`Bearer ${e}`}})).data}catch(t){S(t)}},Q=async e=>{const t=P();if(!t)throw new Error("Token de autenticação não encontrado.");try{return(await k.post(`${U}/user`,e,{headers:{Authorization:`Bearer ${t}`}})).data}catch(o){S(o)}},W=async(e,t)=>{const o=P();if(!o)throw new Error("Token de autenticação não encontrado.");try{return(await k.put(`${U}/user/${e}`,t,{headers:{Authorization:`Bearer ${o}`}})).data}catch(r){S(r)}},X=async e=>{const t=P();if(!t)throw new Error("Token de autenticação não encontrado.");try{await k.delete(`${U}/user/${e}`,{headers:{Authorization:`Bearer ${t}`}})}catch(o){S(o)}},S=e=>{throw e.response?new Error(e.response.data?.message||"Erro de resposta da API."):e.request?new Error("Sem resposta do servidor. Verifique sua conexão."):new Error("Erro ao realizar requisição: "+e.message)},z=6;let c=1,g=[],p=null,L=null;const b=()=>localStorage.getItem("roleUser"),D=document.querySelector("#users-table tbody"),I=document.getElementById("pagination"),f=document.getElementById("search-input"),V=document.getElementById("mensagem-erro"),R=document.getElementById("modal-overlay"),N=document.getElementById("modal-cadastrar"),q=document.getElementById("modal-atualizar"),O=document.getElementById("modal-cadastrando"),_=document.getElementById("modal-atualizando"),A=document.getElementById("modal-confirmando"),w=document.getElementById("modal-deletando"),F=document.getElementById("form-cadastrar"),j=document.getElementById("form-atualizar"),l=document.getElementById("register-name"),n=document.getElementById("register-email"),d=document.getElementById("register-password"),Y=document.getElementById("register-permission"),s=document.getElementById("update-name"),i=document.getElementById("update-email"),m=document.getElementById("update-password"),H=document.getElementById("update-permission"),Z=document.getElementById("add-user-btn"),ee=document.querySelectorAll(".btn-secondary"),te=document.querySelectorAll(".close-modal-btn"),oe=A.querySelector(".btn-primary"),M=document.getElementById("toggle-nav"),C=document.getElementById("navbar"),T=document.getElementById("profile-button"),B=document.getElementById("profile-modal"),ae=document.querySelector(".name"),re=document.querySelector(".email"),J=document.querySelector(".role"),ie=document.getElementById("logout-button"),E=document.getElementById("icon_modal"),$=document.getElementById("text_modal"),h=(e,t=1)=>{D.innerHTML="";const o=(t-1)*z,r=o+z,a=e.slice(o,r);if(a.length===0&&t>1){c=Math.max(1,c-1),h(e,c);return}a.forEach(u=>{const G=D.insertRow();G.innerHTML=`
        <td data-label="Nome">${u.name}</td>
        <td data-label="Email"><div class="editable-cell" contenteditable="true">${u.email}</div></td>
        <td data-label="Permissão">${u.role==="ADMIN"?"Usuário Editor":"Usuário Leitor"}</td>
        <td data-label="Ações">
          <button class="action-btn edit-btn" data-id="${u.id}">
            <span class="material-icons-outlined">edit</span>
          </button>
          <button class="action-btn delete-btn" data-id="${u.id}">
            <span class="material-icons-outlined">delete</span>
          </button>
        </td>
      `}),e.length===0?(V.style.display="block",V.textContent="Nenhum usuário encontrado.",I.innerHTML=""):(V.style.display="none",ne(e))},ne=e=>{const t=Math.ceil(e.length/z);I.innerHTML="";const o=document.createElement("button");o.innerText="Anterior",o.disabled=c===1,o.classList.add("page-btn"),o.addEventListener("click",()=>{c--,h(e,c)}),I.appendChild(o);for(let a=1;a<=t;a++){const u=document.createElement("button");u.innerText=a,u.classList.add("page-btn"),a===c&&u.classList.add("active"),u.addEventListener("click",()=>{c=a,h(e,c)}),I.appendChild(u)}const r=document.createElement("button");r.innerText="Próximo",r.disabled=c===t,r.classList.add("page-btn"),r.addEventListener("click",()=>{c++,h(e,c)}),I.appendChild(r)},y=e=>{R.classList.add("is-open"),e.classList.add("is-open")},v=e=>{e.classList.remove("is-open"),R.classList.remove("is-open"),p=null,L=null,F.reset(),j.reset()},x=async()=>{try{g=await K();const e=g.find(t=>t.email===localStorage.getItem("loginEmail"));e&&(localStorage.setItem("nameUser",e.name),localStorage.setItem("emailUser",e.email),localStorage.setItem("roleUser",e.role)),h(g,c)}catch(e){console.error("Erro ao buscar usuários:",e),V.style.display="block",V.textContent="Erro ao carregar usuários."}};document.addEventListener("DOMContentLoaded",async()=>{await x(),ae.textContent=localStorage.getItem("nameUser"),re.textContent=localStorage.getItem("emailUser"),b()==="ADMIN"?J.textContent="Usuário Editor":J.textContent="Usuário Leitor",f.addEventListener("input",()=>{const e=f.value.toLowerCase().trim(),t=g.filter(o=>{const r=o.role==="ADMIN"?"Usuário Editor":"Usuário Leitor";return o.name.toLowerCase().includes(e)||o.email.toLowerCase().includes(e)||r.toLowerCase().includes(e)});c=1,h(t,c)}),ie.addEventListener("click",e=>{localStorage.removeItem("token"),localStorage.removeItem("nameUser"),localStorage.removeItem("emailUser"),localStorage.removeItem("roleUser"),window.location.href="/index.html"}),Z.addEventListener("click",()=>{b()==="ADMIN"&&y(N)}),ee.forEach(e=>{e.addEventListener("click",t=>{const o=t.target.closest(".modal");v(o)})}),te.forEach(e=>{e.addEventListener("click",t=>{const o=t.target.closest(".modal");v(o)})}),l.addEventListener("input",()=>{l.value.trim().length<3||l.value.trim().length>30?l.setCustomValidity("Por favor, insira um nome válido."):l.setCustomValidity("")}),n.addEventListener("input",()=>{n.validity.typeMismatch||n.value.trim().length<7||n.value.trim().length>50?n.setCustomValidity("Por favor, insira um email válido."):n.setCustomValidity("")}),d.addEventListener("input",()=>{d.value.trim().length<8?d.setCustomValidity("A senha deve possui no mínimo 8 dígitos"):d.value.trim().length>30?d.setCustomValidity("Por favor, insira uma senha válida."):d.setCustomValidity("")}),F.addEventListener("submit",async e=>{if(e.preventDefault(),!l.value.trim()){l.setCustomValidity("O nome é obrigatório."),l.reportValidity();return}if(!n.value.trim()){n.setCustomValidity("O email é obrigatório."),n.reportValidity();return}if(!d.value.trim()){d.setCustomValidity("A senha é obrigatória."),d.reportValidity();return}if(l.value.trim().length<3||l.value.trim().length>30){l.setCustomValidity("Por favor, insira um nome válido."),l.reportValidity();return}if(n.validity.typeMismatch||n.value.trim().length<7||n.value.trim().length>50){n.setCustomValidity("Por favor, insira um email válido."),n.reportValidity();return}if(d.value.trim().length<8){d.setCustomValidity("A senha deve possui no mínimo 8 dígitos"),d.reportValidity();return}if(d.value.trim().length>30){d.setCustomValidity("Por favor, insira uma senha válida."),d.reportValidity();return}const t=g.some(a=>a.name.toLowerCase()===l.value.trim().toLowerCase()),o=g.some(a=>a.email.toLowerCase()===n.value.trim().toLowerCase());if(t){l.setCustomValidity("Já existe um usuário cadastrado com esse nome."),l.reportValidity();return}if(o){n.setCustomValidity("Já existe um usuário cadastrado com esse email."),n.reportValidity();return}const r={name:l.value.trim(),email:n.value.trim(),password:d.value.trim(),role:Y.value.trim()};try{await Q(r),v(N),y(O),setTimeout(()=>v(O),1500),await x(),f.value="",c=1}catch(a){console.error("Erro ao cadastrar usuário:",a),alert("Erro ao cadastrar usuário.")}}),s.addEventListener("input",()=>{s.value.trim().length<3||s.value.trim().length>30?s.setCustomValidity("Por favor, insira um nome válido."):s.setCustomValidity("")}),i.addEventListener("input",()=>{i.validity.typeMismatch||i.value.trim().length<7||i.value.trim().length>50?i.setCustomValidity("Por favor, insira um email válido."):i.setCustomValidity("")}),m.addEventListener("input",()=>{m.value.trim().length<8?m.setCustomValidity("A senha deve possui no mínimo 8 dígitos"):m.value.trim().length>30?m.setCustomValidity("Por favor, insira uma senha válida."):m.setCustomValidity("")}),j.addEventListener("submit",async e=>{if(e.preventDefault(),p===null)return;if(!s.value.trim()){s.setCustomValidity("O nome é obrigatório."),s.reportValidity();return}if(!i.value.trim()){i.setCustomValidity("O email é obrigatório."),i.reportValidity();return}if(!m.value.trim()){m.setCustomValidity("A senha é obrigatória."),m.reportValidity();return}if(s.value.trim().length<3||s.value.trim().length>30){s.setCustomValidity("Por favor, insira um nome válido."),s.reportValidity();return}if(i.validity.typeMismatch||i.value.trim().length<7||i.value.trim().length>50){i.setCustomValidity("Por favor, insira um email válido."),i.reportValidity();return}if(m.value.trim().length<8){m.setCustomValidity("A senha deve possuir no mínimo 8 dígitos"),m.reportValidity();return}if(m.value.trim().length>30){m.setCustomValidity("Por favor, insira uma senha válida."),m.reportValidity();return}const t=g.some(a=>a.id!==p&&a.name.toLowerCase()===s.value.trim().toLowerCase()),o=g.some(a=>a.id!==p&&a.email.toLowerCase()===i.value.trim().toLowerCase());if(t){s.setCustomValidity("Já existe um usuário cadastrado com esse nome."),s.reportValidity();return}if(o){i.setCustomValidity("Já existe um usuário cadastrado com esse email."),i.reportValidity();return}const r={name:s.value.trim(),email:i.value.trim(),role:H.value.trim()};try{await W(p,r),v(q),y(_),setTimeout(()=>v(_),1500),await x(),f.value=""}catch(a){console.error("Erro ao atualizar usuário:",a),alert("Erro ao atualizar usuário.")}}),D.addEventListener("click",e=>{const t=e.target.closest(".edit-btn"),o=e.target.closest(".delete-btn");if(t){if(b()!=="ADMIN")return;p=parseInt(t.dataset.id,10);const r=g.find(u=>u.id===p);if(g.find(u=>u.email===localStorage.getItem("loginEmail")).id===p){E.style.color="red",E.textContent="cancel",$.textContent="Você não pode se editar.",y(w);return}r&&(s.value=r.name,i.value=r.email,m.value="",H.value=r.role,y(q))}if(o){if(b()!=="ADMIN")return;L=parseInt(o.dataset.id,10),y(A)}}),oe.addEventListener("click",async()=>{if(L!==null)if(g.find(t=>t.email===localStorage.getItem("loginEmail")).id===L)E.style.color="red",E.textContent="cancel",$.textContent="Você não pode se excluir.",v(A),y(w),f.value="";else try{await X(L),E.style.color="rgb(24, 209, 24)",E.textContent="check_circle",$.textContent="Usuário excluído!",v(A),y(w),setTimeout(()=>v(w),1500),await x(),f.value=""}catch(t){console.error("Erro ao excluir usuário:",t),alert("Erro ao excluir usuário.")}}),M&&C&&(M.addEventListener("click",e=>{e.stopPropagation(),C.classList.toggle("active")}),document.addEventListener("click",e=>{C.classList.contains("active")&&!C.contains(e.target)&&e.target!==M&&C.classList.remove("active")})),T&&B&&(T.addEventListener("click",()=>{B.classList.toggle("visible")}),document.addEventListener("click",e=>{!T.contains(e.target)&&!B.contains(e.target)&&B.classList.remove("visible")}))});
